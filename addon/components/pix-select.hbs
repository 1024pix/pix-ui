{{! template-lint-disable no-down-event-binding }}
<div
  class="pix-select"
  {{on-click-outside this.hideDropdown}}
  {{on-arrow-down-up-action this.listId this.showDropdown this.isExpanded}}
  {{on-escape-action this.hideDropdown}}
  {{on "keydown" this.lockTab}}
>
  <div class="{{if @screenReaderOnly 'screen-reader-only'}}">
    <label for={{this.selectId}} class="pix-select__label">
      {{#if @requiredLabel}}
        <abbr class="mandatory-mark" title="{{@requiredLabel}}" aria-hidden="true">*</abbr>
      {{/if}}
      {{@label}}
    </label>

    {{#if @subLabel}}
      <span class="pix-select__sub-label">{{@subLabel}}</span>
    {{/if}}
  </div>

  <button
    type="button"
    id={{this.selectId}}
    class="pix-select-button{{this.className}}"
    {{on "click" this.toggleDropdown}}
    aria-expanded={{this.isAriaExpanded}}
    aria-controls={{this.listId}}
    aria-required="{{if @requiredLabel 'true' 'false'}}"
  >
    {{this.placeholder}}

    <FaIcon
      class="pix-select-button__dropdown-icon"
      @icon={{if this.isExpanded "chevron-up" "chevron-down"}}
    />
  </button>
  <div class="pix-select__dropdown{{unless this.isExpanded ' pix-select__dropdown--closed'}}"
    {{#if @isSearchable}}
      <div class="pix-select__search">
        <FaIcon class="pix-select__search__icon" @icon="magnifying-glass" />
        <label class="screen-reader-only" for={{this.searchInputId}}>{{@searchLabel}}</label>
        <input
          class="pix-select__search__input"
          id={{this.searchInputId}}
          autocomplete="off"
          tabindex={{if this.isExpanded "0" "-1"}}
          placeholder={{@searchPlaceholder}}
          {{on "input" this.filterOptions}}
        />
      </div>
    {{/if}}
    <div role="listbox" id={{this.listId}} class="pix-select__options">
      {{#unless this.searchData}}
        <li
          class="pix-select-options-category__option{{unless
            @value
            ' pix-select-options-category__option--selected'
          }}"
          role="option"
          tabindex={{if this.isExpanded "0" "-1"}}
          aria-selected={{if @value "false" "true"}}
          {{on "click" (fn this.onChange this.defaultOption)}}
          {{on-enter-action (fn this.onChange this.defaultOption)}}
        >
          {{@placeholder}}
        </li>
      {{/unless}}
      {{#if this.results}}
        {{#each this.results as |option|}}
          <li
            class="pix-select-options-category__option{{if
              (eq option.value @value)
              ' pix-select-options-category__option--selected'
            }}"
            role="option"
            tabindex={{if this.isExpanded "0" "-1"}}
            aria-selected={{if (eq option.value @value) "true" "false"}}
            {{on "click" (fn this.onChange option)}}
            {{on-enter-action (fn this.onChange option)}}
          >
            {{option.label}}

            {{#if (eq option.value @value)}}
              <FaIcon @icon="check" />
            {{/if}}
          </li>
        {{/each}}
      {{else}}
        <p class="pix-select__empty-search-message">{{@emptySearchMessage}}</p>
      {{/if}}
    </div>
  </div>
</div>